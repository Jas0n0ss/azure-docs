<properties
   pageTitle="云业务连续性 - 时间点还原 | Azure"
   description="了解有关时间点还原的信息，它让你能够将 Azure SQL 数据库回滚到之前的时间点（最多 35 天）。"
   services="sql-database"
   documentationCenter=""
   authors="stevestein"
   manager="jhubbard"
   editor="monicar"/>

<tags
   ms.service="sql-database"
   ms.date="05/10/2016"
   wacn.date="06/14/2016"/>

# 概述：SQL 数据库时间点还原

时间点还原允许你将数据库还原到之前的某个时间点。

Azure SQL 数据库服务通过自动备份保护所有数据库，自动备份将分别保留 7 天（基本版）、14 天（标准版）和 35 天（高级版）。时间点还原的作用在于，在发生意外数据损坏或删除后，从这些备份中恢复你的数据。

数据库备份是自动采用的，不需要选择加入和收取额外的费用。这些自动备份和时间点还原提供零成本、零管理的方式来保护数据库免于遭受意外损坏或删除，不论其原因是什么。

|任务（门户） | PowerShell | REST |
|:--|:--|:--|
| 将 SQL 数据库还原到之前的时间点 | [PowerShell](/documentation/articles/sql-database-point-in-time-restore-powershell/) | [REST (createMode=PointInTimeRestore)](https://msdn.microsoft.com/zh-cn/library/azure/mt163685.aspx) |
| 还原已删除的 SQL 数据库 | [PowerShell](/documentation/articles/sql-database-restore-deleted-database-powershell/) | [REST (createMode=Restore)](https://msdn.microsoft.com/zh-cn/library/azure/mt163685.aspx)|



## 了解自动备份

基本版、标准版和高级版的数据库全都受自动备份保护。完整备份每周进行一次，差异备份每天进行一次，日志备份每 5 分钟进行一次。会在数据库创建后立即计划第一次完整备份。这通常会在 30 分钟内完成，但也可能花费更长时间。如果数据库已经很大，例如它的创建是大数据库复制或还原的结果，那么第一次完整备份可能要花费更长的时间才能完成。在进行了第一次完整备份后，将在后台自动计划和管理所有后续备份。完整备份和差异备份的确切时间由系统决定，以便平衡总体负载。备份文件存储在具有读取访问权限 (RA-GRS) 的异地冗余存储帐户中，以便确保进行灾难恢复时可用。


## 时间点还原的恢复时间

还原数据库所需的时间取决于许多因素，其中包括数据库的大小、选择的时间点和需重播以重构所选点时状态的活动量。对于非常大和/或活动的数据库，还原可能要花费几个小时。还原数据库始终会在原始数据库的同一服务器上创建新的数据库，因此必须为还原的数据库指定新的名称。


可以将数据库还原到任何性能级别或还原到弹性池。你需要确保在服务器或池上具有足够的 DTU 配额，牢记还原将创建新的数据库且还原的数据库的服务层和性能级别可能与活动数据库的当前状态有所不同。还原完成后，还原的数据库将是完全可联机访问的正常数据库，并基于其服务层和性能级别按正常费率计费。如果你出于恢复的目的而还原数据库，可以将还原的数据库作为原始数据库的替代数据库，或使用它来检索数据，然后更新原始数据库。如果还原的数据库旨在替换原始数据库，那么你应该验证性能级别和/或服务层是否合适，如有必要，还应改变该数据库的规模。你可以使用 T-SQL 中的 ALTER DATABASE 命令来重命名原始数据库，然后为还原的数据库指定原有的名称。如果你计划从还原的数据库检索数据，则将需要分别编写和执行任何所需的数据恢复脚本。尽管还原操作可能需要很长时间才能完成，但整个过程中，都可在数据库列表中看见该数据库。如果在还原期间删除数据库，将取消还原操作，且不会向你收费。



## 还原最近删除的数据库

如果删除了基本版、标准版或高级版的数据库，将按正常的保留期保留最终备份，这样你便可将数据库还原到它被删除的时间点。

对于已删除的数据库，还原点固定为数据库的删除时间。与之前一样，还原已删除的数据库时，只能将它还原到包含原始数据库的服务器。删除服务器时请注意这一点，因为一旦服务器被删除，你就不能再还原之前位于该服务器上的数据库。

## 备份/还原与复制/导出/导入

时间点还原是针对意外数据丢失或损坏的情况下恢复基本版、标准版和高级版数据库的建议方法。备份和还原成本更低（除非备份量过多，否则你无需支付任何备份费用，而对于为确保事务性一致导出而进行的数据库复制，以及 BACPAC 文件存储，则需要支付相关费用）、无需管理（备份是自动进行的，但必须自行管理和计划导出）且具有更好的 RPO（相较复制/导出/导入操作，可以更精准地（一分钟）还原到特定时间）和更优的恢复时间（从备份还原通常比导入更快，后者涉及创建架构、禁用索引、加载数据然后为每个表格单独启用索引的各项步骤）。请注意，对于超出保留期的长期存档，仍然建议使用复制和导出解决方案。


## 摘要

自动备份和时间点还原保护数据库免于遭受意外的数据损坏或删除。所有 SQL 数据库均适用此零成本、零管理的解决方案。对于短期恢复的需求，相较复制/导出/导入这种替代解决方案，备份和还原具有显著优势。我们鼓励使用时间点还原作为你的业务连续性战略的一部分，并且仅在需要进行长期存档或数据迁移时才使用导出。



## 其他资源

- [业务连续性概述](/documentation/articles/sql-database-business-continuity/)
- [异地还原](/documentation/articles/sql-database-geo-restore/)
- [活动异地复制](/documentation/articles/sql-database-geo-replication-overview/)
- [设计用于云灾难恢复的应用程序](/documentation/articles/sql-database-designing-cloud-solutions-for-disaster-recovery/)
- [确认已恢复的 Azure SQL 数据库](/documentation/articles/sql-database-recovered-finalize/)



<!---HONumber=Mooncake_0530_2016-->
